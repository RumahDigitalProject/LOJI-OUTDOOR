<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kasir Camping Kekinian</title>
  <style>
    :root{
      --primary:#7c3aed;
      --secondary:#22c55e;
      --bg:#f1f5f9;
      --card:#ffffff;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#0f172a}
    h1,h2,h3{margin:0 0 12px}
    h1{font-size:24px}
    h2{font-size:18px}
    .container{max-width:1100px;margin:auto;padding:16px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.06)}
    button{border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-secondary{background:var(--secondary);color:#fff}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-ghost{background:#e5e7eb}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #cbd5f5;margin-bottom:8px}
    label{font-size:14px}
    .catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
    .item{border:1px solid #e5e7eb;border-radius:14px;padding:12px;text-align:center}
    .price{font-weight:700;color:var(--primary)}
    .badge{background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px;font-size:12px}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
    .modal .card{max-width:420px;width:90%}
  </style>
</head>
<body>
<div class="container">
  <h1>üèïÔ∏è Kasir Persewaan Camping</h1>

  <div class="grid grid-2">
    <div class="card">
      <h2>Katalog Barang</h2>
      <button class="btn-primary" onclick="openItem()">+ Tambah Barang</button>
      <div class="catalog" id="catalog"></div>
    </div>

    <div class="card">
      <h2>Transaksi</h2>
      <div id="cart"></div>
      <hr>
      <label>Diskon</label>
      <input id="discount" placeholder="Rp 0" oninput="calc()">
      <h3>Total: <span class="price" id="total">Rp 0</span></h3>
    </div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <h2>Data Customer</h2>
      <input id="custName" placeholder="Nama Customer">
      <input id="custWa" placeholder="No WhatsApp (628xxx)">
      <input type="date" id="startDate">
      <input type="date" id="endDate">
      <label><input type="checkbox" id="nb"> Nb. Barang hilang wajib ganti</label><br><br>
      <button class="btn-secondary" onclick="checkout()">Simpan & Kirim</button>
    </div>

    <div class="card">
      <h2>Sedang Sewa</h2>
      <div id="active"></div>
    </div>
  </div>
</div>

<!-- Modal Barang -->
<div class="modal" id="modalItem">
  <div class="card">
    <h3>Tambah Barang</h3>
    <input id="itemName" placeholder="Nama barang">
    <input id="itemPrice" type="number" placeholder="Harga / hari">
    <button class="btn-primary" onclick="saveItem()">Simpan</button>
    <button class="btn-ghost" onclick="closeItem()">Batal</button>
  </div>
</div>

<!-- Modal Detail -->
<div class="modal" id="modalDetail"></div>

<script>
const rupiah = n => 'Rp ' + Number(n||0).toLocaleString('id-ID');

let items = JSON.parse(localStorage.getItem('items') || '[]');
let activeRent = JSON.parse(localStorage.getItem('activeRent') || '[]');
let cartData = [];

const catalog = document.getElementById('catalog');
const cartEl = document.getElementById('cart');
const activeEl = document.getElementById('active');
const totalEl = document.getElementById('total');

function days(){
  if(!startDate.value || !endDate.value) return 1;
  const s = new Date(startDate.value);
  const e = new Date(endDate.value);
  const d = Math.ceil((e - s) / 86400000);
  return d <= 1 ? 1 : d;
}

function renderCatalog(){
  catalog.innerHTML = '';
  items.forEach((i,idx)=>{
    catalog.innerHTML += `
      <div class="item">
        <b>${i.name}</b>
        <div class="price">${rupiah(i.price)}/hari</div>
        <button class="btn-secondary" onclick="addCart(${idx})">+ Sewa</button>
      </div>`;
  });
  localStorage.setItem('items', JSON.stringify(items));
}

function addCart(i){
  cartData.push(items[i]);
  calc();
}

function renderCart(){
  cartEl.innerHTML = '';
  const d = days();
  cartData.forEach((c,i)=>{
    const sub = c.price * d;
    cartEl.innerHTML += `
      ${c.name} = ${rupiah(c.price)} x ${d} hari = <b>${rupiah(sub)}</b>
      <button onclick="removeCart(${i})">x</button><br>`;
  });
}

function removeCart(i){
  cartData.splice(i,1);
  calc();
}

function calc(){
  renderCart();
  const d = days();
  let total = cartData.reduce((a,c)=>a + (c.price * d), 0);
  const disc = Number(discount.value.replace(/\D/g,''));
  total -= disc || 0;
  totalEl.innerText = rupiah(total);
}

function checkout(){
  if(!custName.value || !custWa.value || cartData.length===0){
    alert('Lengkapi data customer dan keranjang');return;
  }
  const d = days();
  let msg = `Halo ${custName.value}%0A\nDetail Sewa:%0A`;
  cartData.forEach(c=>{
    msg += `- ${c.name}: ${rupiah(c.price)} x ${d} hari%0A`;
  });
  msg += `Total: ${totalEl.innerText}%0A`;
  msg += `Tanggal: ${startDate.value} s/d ${endDate.value}%0A`;
  if(nb.checked) msg += 'Nb. Barang hilang wajib ganti%0A';

  window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');

  activeRent.push({
    name: custName.value,
    wa: custWa.value,
    start: startDate.value,
    end: endDate.value,
    cart: cartData
  });
  localStorage.setItem('activeRent', JSON.stringify(activeRent));

  cartData = [];
  custName.value = custWa.value = discount.value = '';
  renderActive();
  calc();
}

function renderActive(){
  activeEl.innerHTML = '';
  activeRent.forEach((a,i)=>{
    activeEl.innerHTML += `
      <div class="item">
        <b>${a.name}</b><br>
        <span class="badge">${a.start} - ${a.end}</span><br>
        <button onclick="viewDetail(${i})">Lihat Barang</button>
        <button class="btn-primary" onclick="finishRent(${i})">Selesai</button>
      </div>`;
  });
}

function viewDetail(i){
  let html = '<div class="card"><h3>Detail Barang</h3>';
  activeRent[i].cart.forEach(c=> html += `<div>${c.name}</div>`);
  html += '<button onclick="closeDetail()">Tutup</button></div>';
  modalDetail.innerHTML = html;
  modalDetail.style.display = 'flex';
}

function closeDetail(){ modalDetail.style.display='none'; }

function finishRent(i){
  const a = activeRent[i];
  const text = prompt('Pesan terima kasih','Terima kasih sudah menyewa di tempat kami üôè');
  if(text){ window.open(`https://wa.me/${a.wa}?text=${encodeURIComponent(text)}`,'_blank'); }
  activeRent.splice(i,1);
  localStorage.setItem('activeRent', JSON.stringify(activeRent));
  renderActive();
}

function openItem(){ modalItem.style.display='flex'; }
function closeItem(){ modalItem.style.display='none'; }
function saveItem(){
  if(!itemName.value || !itemPrice.value) return;
  items.push({name:itemName.value, price:Number(itemPrice.value)});
  itemName.value = itemPrice.value = '';
  closeItem();
  renderCatalog();
}

renderCatalog();
renderActive();
</script>
</body>
</html>
