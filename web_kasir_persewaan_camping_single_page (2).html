<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kasir Camping Kekinian PRO</title>
<style>
:root{--p:#7c3aed;--s:#22c55e;--bg:#f1f5f9;--c:#fff;--d:#ef4444}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg)}
.container{max-width:1200px;margin:auto;padding:16px}
.card{background:var(--c);padding:16px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.06)}
h1,h2,h3{margin:0 0 12px}
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
button{border:none;border-radius:12px;padding:8px 14px;font-weight:600;cursor:pointer}
.btn{background:var(--p);color:#fff}
.btn2{background:var(--s);color:#fff}
.btn3{background:#e5e7eb}
input{width:100%;padding:8px;border-radius:10px;border:1px solid #cbd5f5;margin-bottom:6px}
.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.item{border:1px solid #e5e7eb;border-radius:14px;padding:10px;text-align:center}
.price{color:var(--p);font-weight:700}
.badge{background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px;font-size:12px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.modal .card{max-width:450px;width:90%}
</style>
</head>
<body>
<div class="container">
<h1>üèïÔ∏è Kasir Persewaan Camping</h1>

<div class="grid grid-2">
<div class="card">
<h2>Periode Sewa</h2>
<input type="date" id="startDate" onchange="calc()">
<input type="date" id="endDate" onchange="calc()">
<div><b>Durasi:</b> <span id="durasi">1</span> hari</div>
</div>

<div class="card">
<h2>Katalog Barang</h2>
<button class="btn" onclick="openItem()">+ Tambah Barang</button>
<div class="catalog" id="catalog"></div>
</div>
</div>

<div class="grid grid-2">
<div class="card">
<h2>Transaksi</h2>
<div id="cart"></div>
<label>Diskon</label>
<input id="discount" placeholder="Rp 0" oninput="calc()">
<h3>Total: <span class="price" id="total">Rp 0</span></h3>
</div>

<div class="card">
<h2>Data Customer</h2>
<input id="custName" placeholder="Nama Customer">
<input id="custWa" placeholder="No WhatsApp (628xxx)">
<label><input type="checkbox" id="nb"> Nb. Barang hilang wajib ganti</label><br><br>
<button class="btn2" onclick="checkout()">Simpan & Kirim</button>
</div>
</div>

<div class="card">
<h2>Sedang Sewa</h2>
<div id="active"></div>
</div>
</div>

<!-- MODAL BARANG -->
<div class="modal" id="modalItem"><div class="card">
<h3>Barang</h3>
<input id="itemName" placeholder="Nama Barang">
<input id="itemPrice" type="number" placeholder="Harga / hari">
<button class="btn" onclick="saveItem()">Simpan</button>
<button class="btn3" onclick="closeItem()">Batal</button>
</div></div>

<!-- MODAL DETAIL -->
<div class="modal" id="modalDetail"></div>

<script>
const rupiah=n=>'Rp '+Number(n||0).toLocaleString('id-ID');
let items=JSON.parse(localStorage.items||'[]');
let activeRent=JSON.parse(localStorage.activeRent||'[]');
let cartData=[];let editIndex=null;

const catalog=document.getElementById('catalog');
const cartEl=document.getElementById('cart');
const activeEl=document.getElementById('active');
const totalEl=document.getElementById('total');
const durasiEl=document.getElementById('durasi');

function days(){
 if(!startDate.value||!endDate.value) return 1;
 const d=Math.ceil((new Date(endDate.value)-new Date(startDate.value))/86400000);
 return d<=1?1:d;
}

function renderCatalog(){
 catalog.innerHTML='';
 items.forEach((i,idx)=>{
  catalog.innerHTML+=`<div class="item">
  <b>${i.name}</b>
  <div class="price">${rupiah(i.price)}/hari</div>
  <input type="number" min="1" value="1" id="qty${idx}">
  <button class="btn2" onclick="addCart(${idx})">+ Sewa</button>
  <button onclick="editItem(${idx})">Edit</button>
  </div>`;
 });
 localStorage.items=JSON.stringify(items);
}

function openItem(){editIndex=null;modalItem.style.display='flex'}
function closeItem(){modalItem.style.display='none'}
function saveItem(){
 if(!itemName.value||!itemPrice.value) return;
 if(editIndex!==null) items[editIndex]={name:itemName.value,price:Number(itemPrice.value)};
 else items.push({name:itemName.value,price:Number(itemPrice.value)});
 itemName.value=itemPrice.value='';closeItem();renderCatalog();
}
function editItem(i){editIndex=i;itemName.value=items[i].name;itemPrice.value=items[i].price;modalItem.style.display='flex'}

function addCart(i){
 const q=Number(document.getElementById('qty'+i).value)||1;
 cartData.push({...items[i],qty:q});calc();
}

function renderCart(){
 cartEl.innerHTML='';const d=days();durasiEl.innerText=d;
 cartData.forEach((c,i)=>{
  const sub=c.price*c.qty*d;
  cartEl.innerHTML+=`${c.name} (${c.qty}) = ${rupiah(c.price)} x ${d} hari = <b>${rupiah(sub)}</b> <button onclick="cartData.splice(${i},1);calc()">x</button><br>`;
 });
}

function calc(){
 renderCart();
 const d=days();let total=cartData.reduce((a,c)=>a+(c.price*c.qty*d),0);
 const disc=Number(discount.value.replace(/\D/g,''));total-=disc||0;
 totalEl.innerText=rupiah(total);
}

function checkout(){
 if(!custName.value||!custWa.value||!cartData.length) return alert('Lengkapi data');
 const d=days();let msg=`üèïÔ∏è *DETAIL SEWA CAMPING* %0A%0A`;
 msg+=`Nama: ${custName.value}%0A`;
 msg+=`Periode: ${startDate.value} s/d ${endDate.value} (${d} hari)%0A%0A`;
 cartData.forEach(c=>msg+=`‚Ä¢ ${c.name} (${c.qty}) x ${d} hari = ${rupiah(c.price*c.qty*d)}%0A`);
 msg+=`%0ADiskon: ${rupiah(discount.value.replace(/\D/g,''))}%0A`;
 msg+=`Total: ${totalEl.innerText}%0A`;
 if(nb.checked) msg+='%0ANb. Barang hilang wajib ganti%0A';
 window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');
 activeRent.push({name:custName.value,wa:custWa.value,start:startDate.value,end:endDate.value,cart:cartData,disc:discount.value});
 localStorage.activeRent=JSON.stringify(activeRent);
 cartData=[];custName.value=custWa.value=discount.value='';startDate.value=endDate.value='';renderActive();calc();
}

function renderActive(){
 activeEl.innerHTML='';
 activeRent.forEach((a,i)=>{
  activeEl.innerHTML+=`<div class="item"><b>${a.name}</b><br><span class="badge">${a.start} - ${a.end}</span><br><button onclick="viewDetail(${i})">Lihat Barang</button> <button class="btn" onclick="finish(${i})">Selesai</button></div>`;
 });
}

function viewDetail(i){
 let h='<div class="card"><h3>Detail Sewa</h3>';
 activeRent[i].cart.forEach(c=>h+=`${c.name} (${c.qty}) - ${rupiah(c.price)}<br>`);
 if(activeRent[i].disc) h+=`<br>Diskon: ${rupiah(activeRent[i].disc.replace(/\D/g,''))}`;
 h+='<br><button onclick="closeDetail()">Tutup</button></div>';
 modalDetail.innerHTML=h;modalDetail.style.display='flex';
}
function closeDetail(){modalDetail.style.display='none'}

function finish(i){
 const a=activeRent[i];
 let h='<div class="card"><h3>Selesaikan Sewa</h3>';
 ['Kondisi barang baik','Tidak ada kerusakan','Tidak ada barang hilang','Barang rusak','Barang hilang'].forEach(t=>h+=`<label><input type="checkbox"> ${t}</label><br>`);
 h+='<input id="left" placeholder="Barang customer tertinggal">';
 h+='<br><button onclick="sendFinish('+i+')">Kirim</button></div>';
 modalDetail.innerHTML=h;modalDetail.style.display='flex';
}
function sendFinish(i){
 let txt='üôè *TERIMA KASIH*%0A';
 modalDetail.querySelectorAll('input[type=checkbox]:checked').forEach(c=>txt+=`- ${c.parentNode.innerText}%0A`);
 const l=document.getElementById('left').value;if(l) txt+=`Barang tertinggal: ${l}%0A`;
 window.open(`https://wa.me/${activeRent[i].wa}?text=${txt}`,'_blank');
 activeRent.splice(i,1);localStorage.activeRent=JSON.stringify(activeRent);closeDetail();renderActive();
}

renderCatalog();renderActive();
</script>
</body>
</html>