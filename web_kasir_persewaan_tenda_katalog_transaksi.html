<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kasir Persewaan Tenda</title>
  <style>
    :root{
      --primary:#6C63FF;
      --green:#2ecc71;
      --red:#e74c3c;
      --dark:#1e1e2f;
      --card:#2a2a40;
      --bg:#111827;
    }
    *{box-sizing:border-box;font-family:'Segoe UI',sans-serif}
    body{margin:0;background:linear-gradient(135deg,#111827,#1f2933);color:#fff;padding:12px}
    h2{margin:8px 0}
    button{cursor:pointer;border:none;border-radius:10px;padding:10px 14px;font-weight:600}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-danger{background:var(--red);color:#fff}
    .btn-green{background:var(--green);color:#fff}
    .section{background:rgba(255,255,255,0.04);border-radius:16px;padding:12px;margin-bottom:14px}

    /* KATALOG */
    .catalog-header{display:flex;justify-content:space-between;align-items:center}
    .catalog-list{display:flex;gap:12px;overflow-x:auto;padding:10px 0}
    .catalog-list::-webkit-scrollbar{height:6px}
    .catalog-list::-webkit-scrollbar-thumb{background:#444;border-radius:10px}
    .item{
      min-width:220px;
      background:var(--card);
      border-radius:16px;
      padding:12px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      transition:.2s;
    }
    .item.green{border:2px solid var(--green)}
    .item.red{border:2px solid var(--red)}
    .item-name{text-align:center;font-weight:700;font-size:16px}
    .item-stock{position:absolute;right:20px;top:14px;font-size:12px}
    .item-price{text-align:center;margin:6px 0;color:#c7c7ff}
    .item-actions{display:flex;gap:6px}
    .item-actions button{flex:1;font-size:12px;padding:8px}

    /* TRANSAKSI */
    .cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;background:#1f2937;padding:8px;border-radius:10px}
    .cart-item input{width:50px;border-radius:6px;border:none;padding:4px;text-align:center}
    .total{font-size:18px;font-weight:700;text-align:right;margin-top:8px}
    input,textarea{width:100%;padding:10px;border-radius:10px;border:none;margin-bottom:8px}
    label{font-size:12px;color:#ccc}

    /* MODAL */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center}
    .modal-content{background:#1f2937;padding:16px;border-radius:16px;width:90%;max-width:360px}
  </style>
</head>
<body>

  <!-- KATALOG -->
  <div class="section">
    <div class="catalog-header">
      <h2>ðŸ“¦ Katalog</h2>
      <button class="btn-primary" onclick="openModal()">+ Tambah</button>
    </div>
    <div class="catalog-list" id="catalog"></div>
  </div>

  <!-- TRANSAKSI -->
  <div class="section">
    <h2>ðŸ›’ Transaksi</h2>
    <label>Tanggal Sewa</label>
    <input type="date" id="startDate" />
    <input type="date" id="endDate" />

    <div id="cart"></div>
    <div class="total" id="grandTotal">Total: Rp 0</div>

    <label>Nama Customer *</label>
    <input id="custName" />

    <label>No WhatsApp *</label>
    <input id="custWa" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />

    <label><input type="checkbox" id="nbCheck" /> Sertakan NB. Sewa barang</label>

    <button class="btn-green" style="width:100%" onclick="sendWA()">Kirim ke WhatsApp</button>
  </div>

  <!-- MODAL -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <h3>Tambah / Edit Barang</h3>
      <input placeholder="Nama Barang" id="mName" />
      <input placeholder="Harga (Rp)" id="mPrice" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
      <input placeholder="Stok" id="mStock" type="number" />
      <button class="btn-primary" style="width:100%" onclick="saveItem()">Simpan</button>
    </div>
  </div>

<script>
let items=[];
let cart={};
let editIndex=null;

function rupiah(n){return 'Rp '+Number(n).toLocaleString('id-ID');}

function renderCatalog(){
  const c=document.getElementById('catalog');
  c.innerHTML='';
  items.forEach((it,i)=>{
    const div=document.createElement('div');
    div.className='item '+(it.stock>0?'green':'red');
    div.innerHTML=`
      <div class="item-name">${it.name}</div>
      <div class="item-price">${rupiah(it.price)}</div>
      <div class="item-stock">Stok: ${it.stock}</div>
      <div class="item-actions">
        <button class="btn-green" onclick="addToCart(${i})">+</button>
        <button class="btn-primary" onclick="editItem(${i})">Edit</button>
        <button class="btn-danger" onclick="deleteItem(${i})">Hapus</button>
      </div>`;
    c.appendChild(div);
  });
}

function addToCart(i){
  if(items[i].stock<=0) return alert('Stok habis');
  cart[i]=(cart[i]||0)+1;
  items[i].stock--;
  renderCatalog();
  renderCart();
}

function renderCart(){
  const d=document.getElementById('cart');
  d.innerHTML='';
  let total=0;
  const days=getDays();
  Object.keys(cart).forEach(i=>{
    const qty=cart[i];
    const it=items[i];
    const sub=it.price*qty*days;
    total+=sub;
    d.innerHTML+=`
      <div class="cart-item">
        <div>${it.name}<br>${rupiah(it.price)} x ${qty} x ${days} hari</div>
        <div>${rupiah(sub)}</div>
      </div>`;
  });
  document.getElementById('grandTotal').innerText='Total: '+rupiah(total);
}

function getDays(){
  const s=new Date(startDate.value);
  const e=new Date(endDate.value);
  if(!startDate.value||!endDate.value) return 1;
  const diff=(e-s)/(1000*60*60*24);
  return diff<=0?1:diff;
}

startDate.onchange=endDate.onchange=renderCart;

function openModal(){modal.style.display='flex';editIndex=null;mName.value=mPrice.value=mStock.value='';}
function saveItem(){
  const obj={name:mName.value,price:mPrice.value,stock:parseInt(mStock.value)};
  if(editIndex===null) items.push(obj); else items[editIndex]=obj;
  modal.style.display='none';renderCatalog();
}
function editItem(i){openModal();editIndex=i;const it=items[i];mName.value=it.name;mPrice.value=it.price;mStock.value=it.stock;}
function deleteItem(i){if(confirm('Hapus item?')){items.splice(i,1);renderCatalog();renderCart();}}

function sendWA(){
  if(!custName.value||!custWa.value) return alert('Lengkapi data');
  let msg=`Nama: ${custName.value}%0ATgl: ${startDate.value} s/d ${endDate.value}%0A`;
  Object.keys(cart).forEach(i=>{msg+=`- ${items[i].name} x${cart[i]}%0A`;});
  msg+=document.getElementById('grandTotal').innerText;
  if(nbCheck.checked) msg+='%0ANb. Sewa barang';
  window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');
}
</script>
</body>
</html>
