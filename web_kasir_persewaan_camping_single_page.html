<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Loji Outdoor ‚Äì Web Kasir MASTER (FIX)</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root{--p:#16a34a;--s:#22c55e;--bg:#f1f5f9;--c:#fff;--d:#0f172a}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bg);color:var(--d)}
h1,h2,h3{margin:0 0 12px}
.container{max-width:1200px;margin:auto;padding:16px}
.card{background:var(--c);padding:16px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(auto-fit,minmax(320px,1fr))}
button{border:none;border-radius:12px;padding:8px 14px;font-weight:600;cursor:pointer}
.btn{background:var(--p);color:#fff}
.btn2{background:#0ea5e9;color:#fff}
.btn3{background:#ef4444;color:#fff}
input{width:100%;padding:8px;border-radius:10px;border:1px solid #cbd5f5;margin-bottom:6px}
.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.item{border:1px solid #e5e7eb;border-radius:14px;padding:10px;text-align:center}
.price{color:var(--p);font-weight:700}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:50}
.modal .card{max-width:480px;width:90%}
#struk{width:300px;padding:12px;font-size:12px;background:#fff;color:#000}
#struk hr{border:none;border-top:1px dashed #000;margin:6px 0}
</style>
</head>
<body>
<div class="container">
<h1>üèïÔ∏è Loji Outdoor ‚Äì Web Kasir MASTER</h1>

<div class="grid grid-2">
<div class="card">
<h2>Periode Sewa</h2>
<input type="date" id="startDate" onchange="calc()">
<input type="date" id="endDate" onchange="calc()">
<div>Durasi: <b><span id="durasi">1</span> hari</b></div>
</div>

<div class="card">
<h2>Katalog</h2>
<input placeholder="üîç Cari barang..." oninput="searchCatalog(this.value)">
<button class="btn" onclick="openItem()">+ Tambah Barang</button>
<div class="catalog" id="catalog"></div>
</div>
</div>

<div class="grid grid-2">
<div class="card">
<h2>Transaksi</h2>
<div id="cart"></div>
<label>Diskon</label>
<input id="discount" placeholder="Rp 0" oninput="calc()">
<h3>Total: <span class="price" id="total">Rp 0</span></h3>
</div>

<div class="card">
<h2>Customer</h2>
<input id="custName" placeholder="Nama Customer">
<input id="custWa" placeholder="No WhatsApp (628xxx)">
<label><input type="checkbox" id="nb"> Nb. Barang hilang wajib ganti</label><br><br>
<button class="btn2" onclick="checkout()">Simpan & Kirim</button>
<button class="btn" onclick="cetakStruk()">üì∏ Cetak Struk</button>
<button class="btn" onclick="openCustomerPage()">üìí Data Customer</button>
</div>
</div>
</div>

<div id="struk" style="display:none"></div>

<!-- MODAL BARANG -->
<div class="modal" id="modalItem"><div class="card">
<h3>Barang</h3>
<input id="itemName" placeholder="Nama Barang">
<input id="itemPrice" type="number" placeholder="Harga / hari">
<button class="btn" onclick="saveItem()">Simpan</button>
<button onclick="closeModal('modalItem')">Batal</button>
</div></div>

<script>
const rupiah=n=>'Rp '+Number(n||0).toLocaleString('id-ID');
let items=JSON.parse(localStorage.items||'[]');
let cartData=[];
let customers=JSON.parse(localStorage.customers||'{}');

function closeModal(id){document.getElementById(id).style.display='none'}

function days(){
 if(!startDate.value||!endDate.value) return 1;
 const diff=(new Date(endDate.value)-new Date(startDate.value))/86400000;
 return diff<=1?1:Math.ceil(diff);
}

function renderCatalog(list=items){
 catalog.innerHTML='';
 list.forEach((i,idx)=>{
  catalog.innerHTML+=`<div class=item>
   <b>${i.name}</b>
   <div class=price>${rupiah(i.price)}/hari</div>
   <input type=number min=1 value=1 id="q${idx}">
   <button class=btn2 onclick="addCart(${idx})">+ Sewa</button>
   <button class=btn3 onclick="delItem(${idx})">Hapus</button>
  </div>`
 })
 localStorage.items=JSON.stringify(items)
}

function searchCatalog(v){renderCatalog(items.filter(i=>i.name.toLowerCase().includes(v.toLowerCase())))}
function openItem(){document.getElementById('modalItem').style.display='flex'}
function saveItem(){
 if(!itemName.value||!itemPrice.value) return alert('Lengkapi data barang');
 items.push({name:itemName.value,price:+itemPrice.value});
 itemName.value=itemPrice.value='';
 closeModal('modalItem');
 renderCatalog();
}
function delItem(i){if(confirm('Hapus item ini?')){items.splice(i,1);renderCatalog()}}
function addCart(i){cartData.push({...items[i],qty:+document.getElementById('q'+i).value});calc()}

function renderCart(){
 cart.innerHTML='';
 const d=days();
 durasi.innerText=d;
 cartData.forEach(c=>{
  cart.innerHTML+=`${c.name} (${c.qty})<br>${rupiah(c.price)} x ${d} = <b>${rupiah(c.price*c.qty*d)}</b><hr>`
 })
}

function calc(){
 renderCart();
 let t=cartData.reduce((a,c)=>a+c.price*c.qty*days(),0);
 t-=Number(discount.value.replace(/\D/g,''))||0;
 total.innerText=rupiah(t);
}

function checkout(){
 if(!custName.value||!custWa.value) return alert('Lengkapi data customer');
 const d=days();
 customers[custWa.value]=customers[custWa.value]||{name:custName.value,count:0};
 customers[custWa.value].count++;
 localStorage.customers=JSON.stringify(customers);
 let msg=`üì© *STRUK SEWA CAMPING*%0A%0A${custName.value}%0A${startDate.value} s/d ${endDate.value} (${d} hari)%0A%0A`;
 cartData.forEach(c=>msg+=`${c.name} (${c.qty}) : ${rupiah(c.price*c.qty*d)}%0A`);
 msg+=`%0ATotal: ${total.innerText}`;
 if(nb.checked) msg+='%0A%0ANb. Barang hilang wajib ganti';
 window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');
 custName.value=custWa.value=startDate.value=endDate.value=discount.value='';
 cartData=[];calc();
}

function cetakStruk(){
 if(cartData.length) return alert('Selesaikan transaksi dulu');
 const s=document.getElementById('struk');
 s.innerHTML='<b>LOJI OUTDOOR</b><hr>Terima kasih';
 s.style.display='block';
 html2canvas(s).then(c=>{let a=document.createElement('a');a.download='struk.png';a.href=c.toDataURL();a.click();s.style.display='none'})
}

function openCustomerPage(){
 let w=window.open('','cust');
 w.document.write('<h2>Data Customer</h2>');
 Object.values(customers).forEach(c=>w.document.write(`<p>${c.name} - ${c.count}x transaksi</p>`));
}

renderCatalog();
</script>
</body>
</html>
