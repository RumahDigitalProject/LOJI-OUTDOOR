<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kasir Camping Kekinian</title>
  <style>
    :root{
      --primary:#7c3aed; /* ungu */
      --secondary:#22c55e; /* hijau */
      --bg:#f1f5f9;
      --card:#ffffff;
      --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#0f172a}
    h1,h2,h3{margin:0 0 12px}
    h1{font-size:24px}
    h2{font-size:18px}
    .container{max-width:1100px;margin:auto;padding:16px}
    .grid{display:grid;gap:16px}
    .grid-2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .grid-3{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.06)}
    button{border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-secondary{background:var(--secondary);color:#fff}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-ghost{background:#e5e7eb}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #cbd5f5;margin-bottom:8px}
    label{font-size:14px}
    .catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
    .item{border:1px solid #e5e7eb;border-radius:14px;padding:12px;text-align:center}
    .price{font-weight:700;color:var(--primary)}
    .row{display:flex;gap:8px;align-items:center}
    .right{text-align:right}
    .badge{background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px;font-size:12px}
    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center}
    .modal .card{max-width:420px;width:90%}
  </style>
</head>
<body>
<div class="container">
  <h1>üèïÔ∏è Kasir Persewaan Camping</h1>

  <div class="grid grid-2">
    <div class="card">
      <h2>Katalog Barang</h2>
      <button class="btn-primary" onclick="openItem()">+ Tambah Barang</button>
      <div class="catalog" id="catalog"></div>
    </div>

    <div class="card">
      <h2>Transaksi</h2>
      <div id="cart"></div>
      <hr>
      <label>Diskon</label>
      <input id="discount" placeholder="Rp 0" oninput="calc()">
      <h3>Total: <span class="price" id="total">Rp 0</span></h3>
    </div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <h2>Data Customer</h2>
      <input id="custName" placeholder="Nama Customer">
      <input id="custWa" placeholder="No WhatsApp (628xxx)">
      <div class="row">
        <input type="date" id="startDate">
        <input type="date" id="endDate">
      </div>
      <label><input type="checkbox" id="nb"> Nb. Barang hilang wajib ganti</label><br><br>
      <button class="btn-secondary" onclick="checkout()">Simpan & Kirim</button>
    </div>

    <div class="card">
      <h2>Sedang Sewa</h2>
      <div id="active"></div>
    </div>
  </div>
</div>

<!-- Modal Barang -->
<div class="modal" id="modalItem">
  <div class="card">
    <h3>Barang</h3>
    <input id="itemName" placeholder="Nama barang">
    <input id="itemPrice" placeholder="Harga / hari">
    <button class="btn-primary" onclick="saveItem()">Simpan</button>
    <button class="btn-ghost" onclick="closeItem()">Batal</button>
  </div>
</div>

<!-- Modal Detail -->
<div class="modal" id="modalDetail"></div>

<script>
const rupiah=n=>"Rp "+Number(n||0).toLocaleString('id-ID');
let items=JSON.parse(localStorage.items||'[]');
let activeRent=JSON.parse(localStorage.active||'[]');
let cart=[]; let edit=null;

function days(){const s=new Date(startDate.value),e=new Date(endDate.value);const d=(e-s)/86400000;return d<=1?1:d}

function renderCatalog(){
  catalog.innerHTML='';
  items.forEach((i,idx)=>{
    catalog.innerHTML+=`
    <div class="item">
      <b>${i.name}</b>
      <div class="price">${rupiah(i.price)}/hari</div>
      <button class="btn-secondary" onclick="addCart(${idx})">+ Sewa</button>
    </div>`
  })
  localStorage.items=JSON.stringify(items)
}

function addCart(i){cart.push({...items[i],qty:1});calc()}

function renderCart(){
  cart.innerHTML='';
  const d=days();
  cart.forEach((c,i)=>{
    const sub=c.price*d;
    cartDiv.innerHTML+=`${c.name} = ${rupiah(c.price)} x ${d} hari = <b>${rupiah(sub)}</b> <button onclick="cart.splice(${i},1);calc()">x</button><br>`
  })
}

function calc(){
  renderCart();
  const d=days();
  let total=cart.reduce((a,c)=>a+c.price*d,0);
  const disc=Number(discount.value.replace(/\D/g,''));
  total-=disc||0;
  document.getElementById('total').innerText=rupiah(total)
}

function checkout(){
  const d=days();
  let msg=`Halo ${custName.value}%0A\nDetail Sewa:%0A`;
  cart.forEach(c=>msg+=`- ${c.name}: ${rupiah(c.price)} x ${d} hari%0A`)
  msg+=`Total: ${total.innerText}%0A`;
  msg+=`Tanggal: ${startDate.value} s/d ${endDate.value}%0A`;
  if(nb.checked) msg+='Nb. Barang hilang wajib ganti%0A';
  window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');

  activeRent.push({name:custName.value,wa:custWa.value,start:startDate.value,end:endDate.value,cart});
  localStorage.active=JSON.stringify(activeRent);

  cart=[];custName.value=custWa.value='';discount.value='';renderActive();calc();
}

function renderActive(){
  active.innerHTML='';
  activeRent.forEach((a,i)=>{
    active.innerHTML+=`
    <div class="item">
      <b>${a.name}</b><br>
      <span class="badge">${a.start} - ${a.end}</span><br>
      <button onclick="view(${i})">Lihat Barang</button>
      <button class="btn-primary" onclick="finish(${i})">Selesai</button>
    </div>`
  })
}

function view(i){
  let html='<div class="card"><h3>Detail Barang</h3>';
  activeRent[i].cart.forEach(c=>html+=`<div>${c.name}</div>`);
  html+='<button onclick="closeDetail()">Tutup</button></div>';
  modalDetail.innerHTML=html;modalDetail.style.display='flex'
}
function closeDetail(){modalDetail.style.display='none'}

function finish(i){
  const a=activeRent[i];
  let text=prompt('Pesan terima kasih:','Terima kasih sudah menyewa di tempat kami üôè');
  if(text) window.open(`https://wa.me/${a.wa}?text=${encodeURIComponent(text)}`,'_blank');
  activeRent.splice(i,1);localStorage.active=JSON.stringify(activeRent);renderActive()
}

function openItem(){modalItem.style.display='flex'}
function closeItem(){modalItem.style.display='none';edit=null}
function saveItem(){items.push({name:itemName.value,price:Number(itemPrice.value)});itemName.value=itemPrice.value='';closeItem();renderCatalog()}

renderCatalog();renderActive();
</script>
</body>
</html>
