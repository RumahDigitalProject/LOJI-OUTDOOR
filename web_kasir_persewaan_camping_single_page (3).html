<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kasir Camping PRO + Struk Gambar</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
:root{--p:#7c3aed;--s:#22c55e;--bg:#f1f5f9;--c:#fff}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg)}
.container{max-width:1200px;margin:auto;padding:16px}
.card{background:var(--c);padding:16px;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.06)}
h1,h2,h3{margin:0 0 12px}
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
button{border:none;border-radius:12px;padding:8px 14px;font-weight:600;cursor:pointer}
.btn{background:var(--p);color:#fff}
.btn2{background:var(--s);color:#fff}
input{width:100%;padding:8px;border-radius:10px;border:1px solid #cbd5f5;margin-bottom:6px}
.catalog{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.item{border:1px solid #e5e7eb;border-radius:14px;padding:10px;text-align:center}
.price{color:var(--p);font-weight:700}
.badge{background:#ede9fe;color:#6d28d9;padding:4px 8px;border-radius:999px;font-size:12px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
.modal .card{max-width:450px;width:90%}
/* STRUK */
#struk{width:300px;padding:12px;font-size:12px;background:#fff;color:#000}
#struk h3{text-align:center;margin:4px 0}
#struk hr{border:none;border-top:1px dashed #000;margin:6px 0}
</style>
</head>
<body>
<div class="container">
<h1>üèïÔ∏è Kasir Persewaan Camping</h1>

<div class="grid grid-2">
<div class="card">
<h2>Periode Sewa</h2>
<input type="date" id="startDate" onchange="calc()">
<input type="date" id="endDate" onchange="calc()">
<div>Durasi: <b><span id="durasi">1</span> hari</b></div>
</div>

<div class="card">
<h2>Katalog</h2>
<button class="btn" onclick="openItem()">+ Barang</button>
<div class="catalog" id="catalog"></div>
</div>
</div>

<div class="grid grid-2">
<div class="card">
<h2>Transaksi</h2>
<div id="cart"></div>
<label>Diskon</label>
<input id="discount" placeholder="Rp 0" oninput="calc()">
<h3>Total: <span class="price" id="total">Rp 0</span></h3>
</div>

<div class="card">
<h2>Customer</h2>
<input id="custName" placeholder="Nama Customer">
<input id="custWa" placeholder="No WhatsApp (628xxx)">
<label><input type="checkbox" id="nb"> Nb. Barang hilang wajib ganti</label><br><br>
<button class="btn2" onclick="checkout()">Simpan & Kirim</button>
<button class="btn" onclick="cetakStruk()">üì∏ Cetak Struk (Gambar)</button>
</div>
</div>
</div>

<!-- STRUK (HIDDEN) -->
<div id="struk" style="display:none"></div>

<!-- MODAL BARANG -->
<div class="modal" id="modalItem"><div class="card">
<h3>Barang</h3>
<input id="itemName" placeholder="Nama Barang">
<input id="itemPrice" type="number" placeholder="Harga / hari">
<button class="btn" onclick="saveItem()">Simpan</button>
<button onclick="modalItem.style.display='none'">Batal</button>
</div></div>

<script>
const rupiah=n=>'Rp '+Number(n||0).toLocaleString('id-ID');
let items=JSON.parse(localStorage.items||'[]');
let cartData=[];let lastTrans=null;

function days(){if(!startDate.value||!endDate.value) return 1;const d=Math.ceil((new Date(endDate.value)-new Date(startDate.value))/86400000);return d<=1?1:d}

function renderCatalog(){catalog.innerHTML='';items.forEach((i,idx)=>{catalog.innerHTML+=`<div class=item><b>${i.name}</b><div class=price>${rupiah(i.price)}/hari</div><input id=q${idx} type=number value=1 min=1><button class=btn2 onclick=addCart(${idx})>+ Sewa</button></div>`});localStorage.items=JSON.stringify(items)}
function openItem(){modalItem.style.display='flex'}
function saveItem(){items.push({name:itemName.value,price:+itemPrice.value});itemName.value=itemPrice.value='';modalItem.style.display='none';renderCatalog()}
function addCart(i){cartData.push({...items[i],qty:+document.getElementById('q'+i).value});calc()}

function renderCart(){cart.innerHTML='';const d=days();durasi.innerText=d;cartData.forEach(c=>{cart.innerHTML+=`${c.name} (${c.qty}) = ${rupiah(c.price)} x ${d} = <b>${rupiah(c.price*c.qty*d)}</b><br>`})}
function calc(){renderCart();let t=cartData.reduce((a,c)=>a+c.price*c.qty*days(),0);t-=Number(discount.value.replace(/\D/g,''))||0;total.innerText=rupiah(t)}

function checkout(){
const d=days();let msg=`üèïÔ∏è *STRUK SEWA CAMPING*%0A%0A${custName.value}%0A${startDate.value} s/d ${endDate.value} (${d} hari)%0A%0A`;cartData.forEach(c=>msg+=`${c.name} (${c.qty}) : ${rupiah(c.price*c.qty*d)}%0A`);msg+=`%0ATotal: ${total.innerText}`;window.open(`https://wa.me/${custWa.value}?text=${msg}`,'_blank');lastTrans={name:custName.value,wa:custWa.value,start:startDate.value,end:endDate.value,cart:[...cartData],total:total.innerText,disc:discount.value,nb:nb.checked}}

function cetakStruk(){if(!lastTrans) return alert('Belum ada transaksi');
struk.innerHTML=`<h3>CAMPING RENTAL</h3><hr><b>${lastTrans.name}</b><br>${lastTrans.start} - ${lastTrans.end}<hr>`;
lastTrans.cart.forEach(c=>struk.innerHTML+=`${c.name} (${c.qty})<br>${rupiah(c.price)} x ${c.qty} = ${rupiah(c.price*c.qty)}<br>`);
if(lastTrans.disc) struk.innerHTML+=`<hr>Diskon: ${rupiah(lastTrans.disc.replace(/\D/g,''))}`;
struk.innerHTML+=`<hr><b>TOTAL: ${lastTrans.total}</b>`;
struk.style.display='block';
html2canvas(struk).then(canvas=>{const a=document.createElement('a');a.download='struk-sewa.png';a.href=canvas.toDataURL();a.click();struk.style.display='none'})}

renderCatalog();
</script>
</body>
</html>